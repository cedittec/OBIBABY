#Check if the request to the flags file in the server says "video"
if [ "$(curl 'http://104.131.33.240/flags.txt')" = "video" ]
then
	echo ""
	echo "Video request fetched"
	echo""

	#Start streamming video to server. In this case is the server in 104.131.33.240

	raspivid --verbose --nopreview -hf -vf --width 640 --height 480 --framerate 15 --bitrate 1000000 --profile baseline --timeout 0 -o - | gst-launch-0.10 -v fdsrc ! h264parse ! rtph264pay config-interval=1 pt=96 ! udpsink host=104.131.33.240 port=8014 alsasrc device=plughw:Set ! audioconvert ! audioresample ! opusenc ! rtpopuspay ! udpsink host=104.131.33.240 port=8015

#Check if the request to the flags file in the server says "image"
elif [ "$(curl 'http://104.131.33.240/flags.txt')" = "image" ]
then
	#Destroy proceses that may have been created by the streamming app in another thread.

	killall raspivid
	killall gst-launch-0.10

	#Start cicle that will be active while the flags file says "image"

	while [ $(($(date '+%M')%5)) -ne 0 ]
	do
		echo ""
		echo "Image request fetched"
		echo""
		python /home/pi/Desktop/obibaby/src/photo.py
	done
else

	echo ""
	echo "No request fetched"
	echo""

	#If there is not request, we shall still destroy proceses that may have been created by the streamming app in another thread.

	killall raspivid
	killall gst-launch-0.10
	echo "Not flags set"
fi
